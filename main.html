<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>

<canvas id="canvas" width="300" height="500"></canvas>

<script>

    var Breakout = (function(){
        var a=document.getElementById("canvas");
        var canvas = a.getContext("2d");
        var canvas_width = a.getAttribute("width");
        var canvas_height = a.getAttribute("height");
        var colors = ["deeppink","dodgerblue","greenyellow","gold","orangered","seegreen","slategray","purple","peru","lightcoral"];
        var blocklist =[];
        var ball;
        var start_x= (canvas_width*1 + 70)/2-70;
        var start_y= canvas_height-10;


        var board = {
            width: 70,
            height: 10,
            x:start_x,
            y:start_y ,
            moving:0,
            speed: 3,
            draw: function(){
                canvas.fillStyle="white";
                canvas.strokeStyle = "black";
                canvas.fillRect(this.x,this.y,this.width, this.height);
                canvas.strokeRect(this.x,this.y,this.width, this.height);
            },
            setX: function(x){
                if (x<0) this.x=0;
                else if (x+this.width>canvas_width) this.x=canvas_width-this.width;
                else this.x=x;
            }
        };

        var moduleBlock = (function(){
            var _height = 10;
            var _width = 30;
            var Block = function(x,y){
                this.x = x;
                this.y = y;
                this.width = _width;
                this.height = _height;
            };

            Block.prototype.draw =function(color){
                canvas.fillStyle=color;
                canvas.strokeStyle = "black";
                canvas.fillRect(this.x,this.y,this.width, this.height);
                canvas.strokeRect(this.x,this.y,this.width, this.height);
            };

            Block.prototype.removeBlock = function(){
                canvas.clearRect(this.x,this.y,_width, _height);
            };

            var setWidth= function(w){
                _width=w;
            };

            var setHeight= function(h){
                _height=h;
            };

            var getWidth= function(){
                return _width;
            };

            var getHeight= function(){
                return _height;
            };

            return {
                Block:Block,
                setWidth:setWidth,
                setHeight:setHeight,
                getWidth:getWidth,
                getHeight:getHeight
            }

        })();

        var moduleBall = (function(){
            var _radius = 5;


            var Ball = function(x,y){
                this.pos_x = x;
                this.pos_y = y;
                this.x = x -_radius;
                this.x = y-_radius;
                this.width = this.height = 2*_radius;
            };

            Ball.prototype.draw = function(){
                canvas.fillStyle = "red";
                canvas.beginPath();
                canvas.arc(this.pos_x, this.pos_y, _radius,0, 2 * Math.PI);
                canvas.fill();
            };

            Ball.prototype.newPosition = function(new_x,new_y,new_d){
                this.pos_x=new_x;
                this.pos_y=new_y;
                this.direction = new_d;
            };

            var setRadius = function(r){
                _radius = r;
            };

            var getRadius = function(){
                return _radius;
            };

            return {
                Ball:Ball,
                setRadius:setRadius,
                getRadius:getRadius
            }
        })();

        var init = function(){
            //background
            canvas.fillStyle="lavender";
            canvas.fillRect(0,0,canvas_width, canvas_height);
            //blocks
            var z=0;
            for(var i=0;i<canvas_width;i+=moduleBlock.getWidth()){
                for (var j=0;j<canvas_height/2;j+=moduleBlock.getHeight()){
                    blocklist[z]= new moduleBlock.Block(i,j);
                    var color = colors[getRandomInt(1,11)];
                    blocklist[z].draw(color);
                    z++;
                }
            }
            //board
            board.draw();
            //ball
            ball = new moduleBall.Ball(canvas_width/2,canvas_height-board.height-moduleBall.getRadius());
            ball.draw();

            console.log(board.x, board.y,board.width,board.height);
        };

        var getRandomInt = function (min, max) {
            return Math.floor(Math.random() * (max - min) + min);
        };

        var detectCollision = function(obj1, obj2){
            if (obj1.x < obj2.x + obj2.width &&
                    obj1.x + obj1.width > obj2.x &&
                    obj1.y < obj2.y + obj2.height &&
                    obj1.height + obj1.y > obj2.y) {
                return true;
            }
        };

        var update = function() {
            // update the position of the ball
            // update the position of the board
                //listen for user input

            var onkey = function(ev){
                var key = ev.keyCode;
                if(key==37){ //left
                    board.moving = 1;
                }
                else if(key==39){ //right
                    board.moving = 2;
                }
            };

            document.addEventListener('keydown', function(ev) { return onkey(ev);  });
            document.addEventListener('keyup',   function() { board.moving=0; });
            
            switch (board.moving){
                case 1: board.setX(board.x - board.speed); break;
                case 2: board.setX(board.x + board.speed); break;
            }

//
//            canvas.fillStyle="lavender";
//            canvas.fillRect(0,0,canvas_width, canvas_height);

            board.draw();




            // check for collision between ball and blocks
                // update ball velocity
                // make the block disappear

            for(var i=0;i<blocklist.length;i++){
                if(detectCollision(blocklist[i],ball)){
                    ball.newPosition();
                    blocklist[i].removeBlock();
                }
            }

            if(detectCollision(ball,board)){

            }
            // check for collision between ball and board
                // update the ball velocity based on where it hit the board
        };

        var gameLoop = function() {
            update();
            requestAnimationFrame(gameLoop);
        };

        return{
            init:init,
            moduleBall:moduleBall,
            moduleBlock:moduleBlock,
            gameLoop:gameLoop
        }

    })();

    Breakout.init();
Breakout.gameLoop();



</script>

</body>
</html>